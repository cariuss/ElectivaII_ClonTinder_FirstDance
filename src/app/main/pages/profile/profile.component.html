<div class="profile-container">
  <h1>Mi Perfil</h1>

  <div *ngIf="isLoading" class="loading-indicator">Cargando perfil...</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>

  <form [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()">
    <div class="profile-section">
      <h2>Información Básica</h2>
      <div class="form-group">
        <label for="name">Nombre:</label>
        <input id="name" type="text" formControlName="name">
        <div *ngIf="profileForm.get('name')?.invalid && profileForm.get('name')?.touched" class="validation-error">
          El nombre es obligatorio.
        </div>
      </div>

      <div class="form-group">
        <label for="age">Edad:</label>
        <input id="age" type="number" formControlName="age">
        <div *ngIf="profileForm.get('age')?.invalid && profileForm.get('age')?.touched" class="validation-error">
          <span *ngIf="profileForm.get('age')?.errors?.['required']">La edad es obligatoria.</span>
          <span *ngIf="profileForm.get('age')?.errors?.['min'] || profileForm.get('age')?.errors?.['max']">La edad debe estar entre 18 y 100.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="gender">Género:</label>
        <select id="gender" formControlName="gender">
          <option value="">Selecciona tu género</option>
          <option value="Male">Masculino</option>
          <option value="Female">Femenino</option>
          <option value="other">Otro</option>
        </select>
        <div *ngIf="profileForm.get('gender')?.invalid && profileForm.get('gender')?.touched" class="validation-error">
          El género es obligatorio.
        </div>
      </div>

      <div class="form-group">
        <label for="bio">Biografía:</label>
        <textarea id="bio" formControlName="bio" rows="4"></textarea>
        <div *ngIf="profileForm.get('bio')?.invalid && profileForm.get('bio')?.touched" class="validation-error">
          <span *ngIf="profileForm.get('bio')?.errors?.['required']">La biografía es obligatoria.</span>
          <span *ngIf="profileForm.get('bio')?.errors?.['maxlength']">La biografía no puede exceder 500 caracteres.</span>
        </div>
      </div>
    </div>

    <div class="profile-section">
      <h2>Preferencias de Búsqueda</h2>
      <div class="form-group">
        <label for="minAge">Edad mínima:</label>
        <input id="minAge" type="number" formControlName="minAge">
        <div *ngIf="profileForm.get('minAge')?.invalid && profileForm.get('minAge')?.touched" class="validation-error">
          La edad mínima es obligatoria y debe ser al menos 18.
        </div>
      </div>

      <div class="form-group">
        <label for="maxAge">Edad máxima:</label>
        <input id="maxAge" type="number" formControlName="maxAge">
        <div *ngIf="profileForm.get('maxAge')?.invalid && profileForm.get('maxAge')?.touched" class="validation-error">
          La edad máxima es obligatoria y debe ser al menos 18.
        </div>
      </div>

      <div class="form-group">
        <label for="interestedInGender">Interesado en:</label>
        <select id="interestedInGender" formControlName="interestedInGender">
          <option value="">Selecciona</option>
          <option value="Male">Hombres</option>
          <option value="Female">Mujeres</option>
          <option value="other">Otros</option>
        </select>
        <div *ngIf="profileForm.get('interestedInGender')?.invalid && profileForm.get('interestedInGender')?.touched" class="validation-error">
          Este campo es obligatorio.
        </div>
      </div>

      <div class="form-group">
        <label for="maxDistance">Distancia máxima (km):</label>
        <input id="maxDistance" type="number" formControlName="maxDistance">
        <div *ngIf="profileForm.get('maxDistance')?.invalid && profileForm.get('maxDistance')?.touched" class="validation-error">
          La distancia máxima es obligatoria y debe ser al menos 1.
        </div>
      </div>
    </div>

    <div class="profile-section">
      <h2>Ubicación</h2>
      <div class="form-group">
        <label for="city">Ciudad:</label>
        <input id="city" type="text" formControlName="city">
        <div *ngIf="profileForm.get('city')?.invalid && profileForm.get('city')?.touched" class="validation-error">
          La ciudad es obligatoria.
        </div>
      </div>

      <div class="form-group">
        <label for="country">País:</label>
        <input id="country" type="text" formControlName="country">
        <div *ngIf="profileForm.get('country')?.invalid && profileForm.get('country')?.touched" class="validation-error">
          El país es obligatorio.
        </div>
      </div>
    </div>

    <button type="submit" [disabled]="profileForm.invalid || isLoading">Guardar Perfil</button>
  </form>

  <hr>

  <div class="profile-section photo-upload-section">
    <h2>Foto de Perfil</h2>
    <div class="current-photo" *ngIf="profileForm.get('profilePhotoUrl')?.value">
      <img [src]="profileForm.get('profilePhotoUrl')?.value" alt="Foto de Perfil Actual">
    </div>
    <div class="form-group">
      <label for="profilePhoto">Cambiar Foto de Perfil:</label>
      <input id="profilePhoto" type="file" (change)="onProfilePhotoSelected($event)" accept="image/*">
    </div>
    <button (click)="onUploadProfilePhoto()" [disabled]="!profilePhotoFile || isLoading">Subir Foto de Perfil</button>
  </div>

  <hr>

  <div class="profile-section photo-upload-section">
    <h2>Fotos Adicionales</h2>
    <div class="form-group">
      <label for="additionalPhotos">Añadir Fotos Adicionales:</label>
      <input id="additionalPhotos" type="file" (change)="onAdditionalPhotosSelected($event)" multiple accept="image/*">
    </div>
    <button (click)="onUploadAdditionalPhotos()" [disabled]="additionalPhotosFiles.length === 0 || isLoading">Subir Fotos Adicionales</button>
    </div>
</div>
